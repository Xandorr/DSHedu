require('dotenv').config();
const mongoose = require('mongoose');
const Post = require('../models/Post');
const User = require('../models/User');

// MongoDB ì—°ê²°
const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/education-camps', {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });
    console.log('âœ… MongoDB ì—°ê²° ì„±ê³µ');
  } catch (error) {
    console.error('âŒ MongoDB ì—°ê²° ì‹¤íŒ¨:', error);
    process.exit(1);
  }
};

const createNotice = async () => {
  try {
    // ê´€ë¦¬ì ê³„ì • ì°¾ê¸° ë˜ëŠ” ìƒì„±
    let admin = await User.findOne({ role: 'admin' });
    
    if (!admin) {
      console.log('ê´€ë¦¬ì ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤...');
      admin = new User({
        name: 'ê´€ë¦¬ì',
        email: 'admin@dshedu.net',
        password: 'hashed_password', // ì‹¤ì œë¡œëŠ” í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸
        role: 'admin'
      });
      await admin.save();
      console.log('âœ… ê´€ë¦¬ì ê³„ì • ìƒì„± ì™„ë£Œ');
    }

    // ê¸°ì¡´ ì´ìš©ìˆ˜ì¹™ ê³µì§€ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸
    const existingNotice = await Post.findOne({ 
      title: { $regex: 'ì»¤ë®¤ë‹ˆí‹° ì´ìš©ìˆ˜ì¹™' },
      category: 'notice'
    });

    if (existingNotice) {
      console.log('âœ… ì´ë¯¸ ì´ìš©ìˆ˜ì¹™ ê³µì§€ì‚¬í•­ì´ ì¡´ì¬í•©ë‹ˆë‹¤:', existingNotice.title);
      return;
    }

    // ê³µì§€ì‚¬í•­ ìƒì„±
    const notice = new Post({
      title: 'ğŸ“‹ ì»¤ë®¤ë‹ˆí‹° ì´ìš©ìˆ˜ì¹™ ë° ì•ˆë‚´ì‚¬í•­',
      content: `ì•ˆë…•í•˜ì„¸ìš”, DSHì—ë“€ ì»¤ë®¤ë‹ˆí‹° íšŒì› ì—¬ëŸ¬ë¶„!

ê±´ì „í•˜ê³  ìœ ìµí•œ ì»¤ë®¤ë‹ˆí‹° í™˜ê²½ ì¡°ì„±ì„ ìœ„í•´ ë‹¤ìŒ ì´ìš©ìˆ˜ì¹™ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

## ğŸ“ ê²Œì‹œíŒ ì´ìš©ìˆ˜ì¹™

**âœ… ê¶Œì¥ì‚¬í•­**
â€¢ ì„œë¡œ ì¡´ì¤‘í•˜ê³  ë°°ë ¤í•˜ëŠ” ë§ˆìŒìœ¼ë¡œ ì†Œí†µí•´ì£¼ì„¸ìš”
â€¢ ê±´ì„¤ì ì´ê³  ìœ ìµí•œ ì •ë³´ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”
â€¢ ê¶ê¸ˆí•œ ì ì€ ì–¸ì œë“  Q&A ê²Œì‹œíŒì„ í™œìš©í•´ì£¼ì„¸ìš”
â€¢ ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì—°ë½ì²˜ ë“± ë¯¼ê°ì •ë³´ ê³µìœ ëŠ” ìì œí•´ì£¼ì„¸ìš”

**âŒ ê¸ˆì§€ì‚¬í•­**
â€¢ ìš•ì„¤, ë¹„ë°©, ì°¨ë³„ì  í‘œí˜„
â€¢ ìƒì—…ì  ê´‘ê³ ë‚˜ ìŠ¤íŒ¸ì„± ê²Œì‹œë¬¼
â€¢ íƒ€ì¸ì˜ ê°œì¸ì •ë³´ ë¬´ë‹¨ ê²Œì‹œ
â€¢ ì €ì‘ê¶Œì„ ì¹¨í•´í•˜ëŠ” ì½˜í…ì¸ 

## ğŸ•ï¸ í”„ë¡œê·¸ë¨ ê´€ë ¨ íŠ¹ë³„ ì•ˆë‚´

**í”„ë¡œê·¸ë¨ ì°¸ì—¬ ê²½í—˜ë‹´ì˜ ê²½ìš°**, ë” ë§ì€ ë¶„ë“¤ê»˜ ë„ì›€ì´ ë˜ë„ë¡ ì €í¬ê°€ ë³„ë„ë¡œ **ê³µì‹ í›„ê¸° í˜ì´ì§€**ì— ì •ë¦¬í•˜ì—¬ í™ˆí˜ì´ì§€ ë©”ì¸ì— ì†Œê°œí•  ì˜ˆì •ì…ë‹ˆë‹¤. 

ì´ë¥¼ ìœ„í•´ í”„ë¡œê·¸ë¨ ì§ì ‘ ì°¸ì—¬ìë¶„ë“¤ì˜ ì†Œì¤‘í•œ ê²½í—˜ë‹´ì€ **ê°œë³„ ì—°ë½**ì„ í†µí•´ ì •ì‹ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ìˆìœ¼ë©°, ê²Œì‹œíŒì— ì˜¬ë ¤ì£¼ì‹  ê´€ë ¨ ê¸€ë“¤ì€ ì •ë¦¬ ê³¼ì •ì—ì„œ **ì´ë™ ë˜ëŠ” ì •ë¦¬**ë  ìˆ˜ ìˆìŒì„ ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

## ğŸ’¬ ì¹´í…Œê³ ë¦¬ë³„ ì´ìš© ê°€ì´ë“œ

â€¢ **ììœ ê²Œì‹œíŒ**: ì¼ìƒ ì´ì•¼ê¸°, ìº í”„ ì¤€ë¹„ íŒ ë“± ììœ ë¡œìš´ ì†Œí†µ
â€¢ **ì •ë³´ ê³µìœ **: ìœ í•™/ìº í”„ ê´€ë ¨ ìœ ìš©í•œ ì •ë³´ì™€ ë…¸í•˜ìš°
â€¢ **Q&A**: ê¶ê¸ˆí•œ ì  ì§ˆë¬¸ ë° ë‹µë³€
â€¢ **ê³µì§€ì‚¬í•­**: ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­ (ê´€ë¦¬ìë§Œ ì‘ì„± ê°€ëŠ¥)

## ğŸ¤ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ì»¤ë®¤ë‹ˆí‹°

ì—¬ëŸ¬ë¶„ì˜ ì ê·¹ì ì¸ ì°¸ì—¬ì™€ ë°°ë ¤ë¡œ ë”ìš± ë”°ëœ»í•˜ê³  ìœ ìµí•œ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ë§Œë“¤ì–´ê°€ê² ìŠµë‹ˆë‹¤.

ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½í•´ì£¼ì„¸ìš”!

DSHì—ë“€ ë“œë¦¼ â¤ï¸`,
      author: admin._id,
      category: 'notice',
      tags: ['ì´ìš©ìˆ˜ì¹™', 'ì•ˆë‚´', 'ì»¤ë®¤ë‹ˆí‹°', 'ê³µì§€'],
      isPublished: true,
      views: 0
    });

    await notice.save();
    console.log('âœ… ê³µì§€ì‚¬í•­ ìƒì„± ì™„ë£Œ:', notice.title);

    // í™˜ì˜ ê³µì§€ì‚¬í•­ë„ ìƒì„±
    const welcomeNotice = await Post.findOne({ 
      title: { $regex: 'í™˜ì˜í•©ë‹ˆë‹¤' },
      category: 'notice'
    });

    if (!welcomeNotice) {
      const welcome = new Post({
        title: 'ğŸ‰ DSHì—ë“€ ì»¤ë®¤ë‹ˆí‹°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
        content: `ì•ˆë…•í•˜ì„¸ìš”! DSHì—ë“€ ì»¤ë®¤ë‹ˆí‹°ì— ì˜¤ì‹  ê²ƒì„ ì§„ì‹¬ìœ¼ë¡œ í™˜ì˜í•©ë‹ˆë‹¤.

ì´ê³³ì€ ë¯¸êµ­ ìº í”„ í”„ë¡œê·¸ë¨ì— ì°¸ì—¬í•˜ì‹  ë¶„ë“¤ê³¼ ê´€ì‹¬ ìˆëŠ” ë¶„ë“¤ì´ ëª¨ì—¬ ì†Œì¤‘í•œ ê²½í—˜ê³¼ ì •ë³´ë¥¼ ë‚˜ëˆ„ëŠ” ê³µê°„ì…ë‹ˆë‹¤.

**ì»¤ë®¤ë‹ˆí‹° ì´ìš© ì•ˆë‚´:**
- ğŸ—£ï¸ ììœ ê²Œì‹œíŒ: ì¼ìƒ ì´ì•¼ê¸°, ì§ˆë¬¸, ì •ë³´ ê³µìœ 
- ğŸ“Š ì •ë³´ ê³µìœ : ìº í”„ ì°¸ì—¬ ì •ë³´ì™€ ê²½í—˜ë‹´
- ğŸ“¢ ê³µì§€ì‚¬í•­: ì¤‘ìš”í•œ ì•ˆë‚´ì‚¬í•­
- â“ Q&A: ê¶ê¸ˆí•œ ì  ë¬¸ì˜

ë§ì€ ì°¸ì—¬ ë¶€íƒë“œë¦½ë‹ˆë‹¤! ğŸ˜Š`,
        author: admin._id,
        category: 'notice',
        tags: ['í™˜ì˜', 'ì•ˆë‚´', 'ì»¤ë®¤ë‹ˆí‹°'],
        isPublished: true,
        views: 0,
        createdAt: new Date('2025-03-01')
      });

      await welcome.save();
      console.log('âœ… í™˜ì˜ ê³µì§€ì‚¬í•­ ìƒì„± ì™„ë£Œ:', welcome.title);
    }

    console.log('ğŸ‰ ëª¨ë“  ê³µì§€ì‚¬í•­ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
    
  } catch (error) {
    console.error('âŒ ê³µì§€ì‚¬í•­ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
  }
};

const main = async () => {
  await connectDB();
  await createNotice();
  await mongoose.connection.close();
  console.log('ğŸ”Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ');
  process.exit(0);
};

main(); 