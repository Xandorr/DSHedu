<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= post.title %> | DSH에듀 커뮤니티</title>
  <meta name="description" content="<%= post.content.length > 160 ? post.content.substring(0, 160) + '...' : post.content %>">
  <meta name="keywords" content="DSH에듀, 커뮤니티, <%= post.category === 'general' ? '자유게시판' : post.category === 'info' ? '정보공유' : post.category === 'notice' ? '공지사항' : 'Q&A' %>, <%= post.tags ? post.tags.join(', ') : '' %>">
  
  <!-- Open Graph 메타 태그 (페이스북, 카카오톡 등) -->
  <meta property="og:title" content="<%= post.title %> | DSH에듀 커뮤니티">
  <meta property="og:description" content="<%= post.content.length > 160 ? post.content.substring(0, 160) + '...' : post.content %>">
  <meta property="og:type" content="article">
  <meta property="og:url" content="<%= req.protocol %>://<%= req.get('host') %>/posts/<%= post._id %>">
  <meta property="og:site_name" content="DSH에듀">
  <% if (post.images && post.images.length > 0) { %>
    <meta property="og:image" content="<%= req.protocol %>://<%= req.get('host') %><%= post.images[0] %>">
  <% } else { %>
    <meta property="og:image" content="<%= req.protocol %>://<%= req.get('host') %>/images/logo.png">
  <% } %>
  <meta property="og:locale" content="ko_KR">
  
  <!-- 트위터 카드 메타 태그 -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= post.title %> | DSH에듀 커뮤니티">
  <meta name="twitter:description" content="<%= post.content.length > 160 ? post.content.substring(0, 160) + '...' : post.content %>">
  <% if (post.images && post.images.length > 0) { %>
    <meta name="twitter:image" content="<%= req.protocol %>://<%= req.get('host') %><%= post.images[0] %>">
  <% } else { %>
    <meta name="twitter:image" content="<%= req.protocol %>://<%= req.get('host') %>/images/logo.png">
  <% } %>
  
  <!-- 기타 SEO 메타 태그 -->
  <meta name="author" content="<%= post.author.name %>">
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  <link rel="canonical" href="<%= req.protocol %>://<%= req.get('host') %>/posts/<%= post._id %>">
  
  <!-- 구조화된 데이터 (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "<%= post.title %>",
    "description": "<%= post.content.length > 160 ? post.content.substring(0, 160) + '...' : post.content %>",
    "author": {
      "@type": "Person",
      "name": "<%= post.author.name %>"
    },
    "publisher": {
      "@type": "Organization",
      "name": "DSH에듀",
      "logo": {
        "@type": "ImageObject",
        "url": "<%= req.protocol %>://<%= req.get('host') %>/images/logo.png"
      }
    },
    "datePublished": "<%= new Date(post.createdAt).toISOString() %>",
    "dateModified": "<%= new Date(post.updatedAt || post.createdAt).toISOString() %>",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "<%= req.protocol %>://<%= req.get('host') %>/posts/<%= post._id %>"
    },
    "articleSection": "<%= post.category === 'general' ? '자유게시판' : post.category === 'info' ? '정보공유' : post.category === 'notice' ? '공지사항' : 'Q&A' %>",
    <% if (post.images && post.images.length > 0) { %>
    "image": [
      <% post.images.forEach((image, index) => { %>
        "<%= req.protocol %>://<%= req.get('host') %><%= image %>"<%= index < post.images.length - 1 ? ',' : '' %>
      <% }) %>
    ],
    <% } %>
    "interactionStatistic": {
      "@type": "InteractionCounter",
      "interactionType": "https://schema.org/ReadAction",
      "userInteractionCount": <%= post.views %>
    }
  }
  </script>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- AOS Animation Library -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<%- include('../partials/header') %>

<div class="container my-5">
  <div class="row">
    <!-- 메인 콘텐츠 -->
    <div class="col-lg-8">
      <!-- 게시글 -->
      <article class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
          <!-- 헤더 -->
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <span class="badge 
                <%= post.category === 'notice' ? 'bg-danger' : 
                    post.category === 'info' ? 'bg-success text-white' :
                    post.category === 'qna' ? 'bg-info text-white' : 'bg-secondary' %> me-5">
                <%= post.category === 'general' ? '자유' :
                    post.category === 'info' ? '정보 공유' :
                    post.category === 'notice' ? '공지' :
                    post.category === 'qna' ? 'Q&A' : post.category %>
              </span>
              <small class="text-muted">
                <%= new Date(post.createdAt).toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                }) %>
              </small>
            </div>
            
            <% if (user && post.author && post.author._id && (post.author._id.toString() === user._id.toString() || user.role === 'admin')) { %>
              <div class="dropdown" style="position: relative; z-index: 1050;">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" 
                        data-bs-toggle="dropdown">
                  <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="/posts/<%= post._id %>/edit">
                    <i class="fas fa-edit me-2"></i>수정
                  </a></li>
                  <li><a class="dropdown-item text-danger" href="#" 
                         onclick="deletePost('<%= post._id %>')">
                    <i class="fas fa-trash me-2"></i>삭제
                  </a></li>
                </ul>
              </div>
            <% } %>
          </div>

          <!-- 제목 -->
          <h1 class="h2 mb-3">
            <%= post.title %>
            <% if (post.isPrivate) { %>
              <i class="fas fa-lock text-warning ms-2" title="비밀글"></i>
            <% } %>
          </h1>

          <!-- 작성자 정보 -->
          <div class="d-flex align-items-center mb-4">
            <% if (post.author.profilePhoto) { %>
              <img src="<%= post.author.profilePhoto %>" alt="프로필 사진" 
                   class="rounded-circle me-3" style="width: 40px; height: 40px; object-fit: cover;">
            <% } else { %>
              <div class="avatar-circle me-3">
                <i class="fas fa-user"></i>
              </div>
            <% } %>
            <div>
        <h6 class="mb-1">
          <%= post.author.name %>
        </h6>
        <% if (post.author.role === 'admin') { %>
          <div class="mb-2">
            <span class="badge bg-warning text-dark" style="font-size: 0.7rem;">
              <i class="fas fa-crown me-1"></i>관리자
            </span>
          </div>
        <% } else if (post.author.communityLevel && post.author.communityLevel.level) { %>
          <div class="mb-2">
            <span class="badge <%= post.author.communityLevel.level === 1 ? 'bg-secondary' : post.author.communityLevel.level === 2 ? 'level-2-silver' : post.author.communityLevel.level === 3 ? 'bg-warning text-dark' : post.author.communityLevel.level === 4 ? 'level-4-platinum' : 'level-5-diamond' %>" style="font-size: 0.7rem;">
              <i class="<%= post.author.communityLevel.level === 1 ? 'fas fa-medal' : post.author.communityLevel.level === 2 ? 'fas fa-medal' : post.author.communityLevel.level === 3 ? 'fas fa-medal' : post.author.communityLevel.level === 4 ? 'fas fa-gem' : 'fas fa-crown' %> me-1"></i>
              <%= post.author.communityLevel.title %>
            </span>
          </div>
        <% } %>
              <small class="text-muted">
                <% if (post.author.role === 'admin') { %>
                  <i class="fas fa-user me-1"></i>관리자
                <% } else { %>
                  <i class="fas fa-user me-1"></i>회원
                <% } %>
                <% if (post.author.communityLevel && post.author.communityLevel.experience) { %>
                  <span class="ms-2">
                    <i class="fas fa-star text-warning me-1"></i><%= post.author.communityLevel.experience %>XP
                  </span>
                <% } %>
              </small>
            </div>
          </div>

          <!-- 메타 정보 -->
          <div class="d-flex gap-3 mb-4 text-muted small border-bottom pb-3">
            <span><i class="fas fa-eye me-1"></i>조회 <%= post.views %></span>
            <span><i class="fas fa-heart me-1"></i>좋아요 <span id="likesCount"><%= post.likes.length %></span></span>
            <span><i class="fas fa-comment me-1"></i>댓글 <%= comments.length %></span>
          </div>

          <!-- 내용 -->
          <div class="post-content mb-4">
            <% if (post.images && post.images.length > 0) { %>
              <div class="post-images mb-4">
                <% post.images.forEach((image, index) => { %>
                  <img src="<%= image %>" alt="게시글 이미지 <%= index + 1 %>" 
                       class="img-fluid rounded mb-3 w-100" 
                       style="max-height: 500px; object-fit: cover;" 
                       onclick="openImageModal('<%= image %>')">
                <% }) %>
              </div>
            <% } %>

            <div class="content-text">
              <%- post.content.replace(/\n/g, '<br>') %>
            </div>

            <% if (post.youtubeUrl) { %>
              <div class="youtube-container mt-4">
                <% const videoId = post.getYoutubeVideoId(); %>
                <% if (videoId) { %>
                  <div class="ratio ratio-16x9">
                    <iframe src="https://www.youtube.com/embed/<%= videoId %>" 
                            title="YouTube video" allowfullscreen class="rounded"></iframe>
                  </div>
                <% } else { %>
                  <a href="<%= post.youtubeUrl %>" target="_blank" class="btn btn-outline-danger">
                    <i class="fab fa-youtube me-2"></i>유튜브 영상 보기
                  </a>
                <% } %>
              </div>
            <% } %>
          </div>

          <!-- 태그 -->
          <% if (post.tags && post.tags.length > 0) { %>
            <div class="mb-4">
              <% post.tags.forEach(tag => { %>
                <span class="badge bg-light text-dark me-1">#<%= tag %></span>
              <% }) %>
            </div>
          <% } %>

          <!-- 좋아요 버튼 -->
          <div class="text-center py-3 border-top border-bottom">
            <% if (user) { %>
              <button class="btn btn-outline-danger btn-lg" id="likeBtn" onclick="toggleLike()">
                <i class="fas fa-heart me-2" id="likeIcon"></i>
                <span id="likeText">좋아요</span>
              </button>
            <% } else { %>
              <button class="btn btn-outline-secondary btn-lg" onclick="alert('로그인이 필요합니다.'); location.href='/login';">
                <i class="fas fa-heart me-2"></i>
                좋아요 (로그인 필요)
              </button>
            <% } %>
          </div>
        </div>
      </article>

      <!-- 댓글 섹션 -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-comments me-2"></i>댓글 <span class="text-muted">(<%= comments.length %>)</span>
          </h5>
        </div>
        <div class="card-body">
          <!-- 댓글 작성 폼 -->
          <% if (user) { %>
            <form id="commentForm" class="mb-4">
              <div class="d-flex gap-3">
                <% if (user.profilePhoto) { %>
                  <img src="<%= user.profilePhoto %>" alt="프로필 사진" 
                       class="rounded-circle flex-shrink-0" style="width: 40px; height: 40px; object-fit: cover;">
                <% } else { %>
                  <div class="avatar-circle flex-shrink-0">
                    <i class="fas fa-user"></i>
                  </div>
                <% } %>
                <div class="flex-grow-1">
                  <textarea class="form-control" id="commentContent" rows="3" 
                            placeholder="댓글을 작성해보세요..." maxlength="1000"></textarea>
                  <div class="d-flex justify-content-between align-items-center mt-2">
                    <small class="text-muted">최대 1000자</small>
                    <button type="submit" class="btn btn-primary">
                      <i class="fas fa-paper-plane me-1"></i>댓글 작성
                    </button>
                  </div>
                </div>
              </div>
            </form>
          <% } else { %>
            <div class="text-center py-4 border rounded">
              <p class="text-muted mb-2">댓글을 작성하려면 로그인이 필요합니다.</p>
              <a href="/login" class="btn btn-primary">로그인</a>
            </div>
          <% } %>

          <!-- 댓글 목록 -->
          <div id="commentsList">
            <% if (comments && comments.length > 0) { %>
              <% comments.forEach(comment => { %>
                <div class="comment-item border-bottom py-3" data-comment-id="<%= comment._id %>">
                  <div class="d-flex gap-3">
                    <% if (comment.author.profilePhoto) { %>
                      <img src="<%= comment.author.profilePhoto %>" alt="프로필 사진" 
                           class="rounded-circle flex-shrink-0" style="width: 40px; height: 40px; object-fit: cover;">
                    <% } else { %>
                      <div class="avatar-circle flex-shrink-0">
                        <i class="fas fa-user"></i>
                      </div>
                    <% } %>
                    <div class="flex-grow-1">
                      <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                          <strong><%= comment.author.name %></strong>
                          <% if (comment.author.role === 'admin') { %>
                            <div class="mt-1">
                              <span class="badge bg-warning text-dark" style="font-size: 0.6rem;">
                                <i class="fas fa-crown me-1"></i>관리자
                              </span>
                            </div>
                          <% } else if (comment.author.communityLevel && comment.author.communityLevel.level) { %>
                            <div class="mt-1">
                              <span class="badge <%= comment.author.communityLevel.level === 1 ? 'bg-secondary' : comment.author.communityLevel.level === 2 ? 'level-2-silver' : comment.author.communityLevel.level === 3 ? 'bg-warning text-dark' : comment.author.communityLevel.level === 4 ? 'level-4-platinum' : 'level-5-diamond' %>" style="font-size: 0.6rem;">
                                <i class="<%= comment.author.communityLevel.level === 1 ? 'fas fa-medal' : comment.author.communityLevel.level === 2 ? 'fas fa-medal' : comment.author.communityLevel.level === 3 ? 'fas fa-medal' : comment.author.communityLevel.level === 4 ? 'fas fa-gem' : 'fas fa-crown' %> me-1"></i>
                                <%= comment.author.communityLevel.title %>
                              </span>
                            </div>
                          <% } %>
                          <small class="text-muted ms-2">
                            <%= new Date(comment.createdAt).toLocaleDateString('ko-KR', {
                              month: 'short',
                              day: 'numeric',
                              hour: '2-digit',
                              minute: '2-digit'
                            }) %>
                          </small>
                        </div>
                        <% if (user && (comment.author._id.toString() === user._id.toString() || user.role === 'admin')) { %>
                          <button class="btn btn-outline-danger btn-sm" 
                                  onclick="deleteComment('<%= comment._id %>')">
                            <i class="fas fa-times"></i>
                          </button>
                        <% } %>
                      </div>
                      <div class="comment-content">
                        <%- comment.content.replace(/\n/g, '<br>') %>
                      </div>
                    </div>
                  </div>
                </div>
              <% }) %>
            <% } else { %>
              <div class="text-center py-4 text-muted">
                <i class="fas fa-comment fa-2x mb-3"></i>
                <p>첫 번째 댓글을 작성해보세요!</p>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>

    <!-- 사이드바 -->
    <div class="col-lg-4">
      <div class="sticky-top" style="top: 2rem;">
        <!-- 목록으로 돌아가기 -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body text-center">
            <a href="/posts" class="btn btn-outline-primary">
              <i class="fas fa-arrow-left me-2"></i>목록으로 돌아가기
            </a>
          </div>
        </div>

        <!-- 작성자 정보 -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-white">
            <h6 class="mb-0">작성자 정보</h6>
          </div>
          <div class="card-body text-center">
            <% if (post.author.profilePhoto) { %>
              <img src="<%= post.author.profilePhoto %>" alt="프로필 사진" 
                   class="rounded-circle mx-auto mb-3" style="width: 60px; height: 60px; object-fit: cover;">
            <% } else { %>
              <div class="avatar-circle mx-auto mb-3" style="width: 60px; height: 60px; font-size: 24px;">
                <i class="fas fa-user"></i>
              </div>
            <% } %>
        <h6 class="mb-2">
          <%= post.author.name %>
        </h6>
        <% if (post.author.role === 'admin') { %>
          <div class="mb-3">
            <span class="badge bg-warning text-dark" style="font-size: 0.7rem;">
              <i class="fas fa-crown me-1"></i>관리자
            </span>
          </div>
        <% } else if (post.author.communityLevel && post.author.communityLevel.level) { %>
          <div class="mb-3">
            <span class="badge <%= post.author.communityLevel.level === 1 ? 'bg-secondary' : post.author.communityLevel.level === 2 ? 'level-2-silver' : post.author.communityLevel.level === 3 ? 'bg-warning text-dark' : post.author.communityLevel.level === 4 ? 'level-4-platinum' : 'level-5-diamond' %>" style="font-size: 0.7rem;">
              <i class="<%= post.author.communityLevel.level === 1 ? 'fas fa-medal' : post.author.communityLevel.level === 2 ? 'fas fa-medal' : post.author.communityLevel.level === 3 ? 'fas fa-medal' : post.author.communityLevel.level === 4 ? 'fas fa-gem' : 'fas fa-crown' %> me-1"></i>
              <%= post.author.communityLevel.title %>
            </span>
          </div>
        <% } %>
            <p class="text-muted small mb-2">
              <%= new Date(post.author.createdAt).toLocaleDateString('ko-KR', {year: 'numeric', month: 'long'}) %> 가입
            </p>
            <% if (post.author.communityLevel && post.author.communityLevel.experience) { %>
              <div class="mb-2">
                <small class="text-muted">경험치: <%= post.author.communityLevel.experience %>XP</small>
                <div class="progress mt-1" style="height: 6px;">
                  <div class="progress-bar bg-warning" role="progressbar" 
                       style="width: <%= post.author.getLevelProgress ? post.author.getLevelProgress().progress : 0 %>%"></div>
                </div>
              </div>
            <% } %>
            <% if (post.author.activityStats) { %>
              <div class="row text-center">
                <div class="col-4">
                  <small class="text-muted d-block">게시글</small>
                  <strong class="text-primary"><%= post.author.activityStats.postsCount || 0 %></strong>
                </div>
                <div class="col-4">
                  <small class="text-muted d-block">댓글</small>
                  <strong class="text-success"><%= post.author.activityStats.commentsCount || 0 %></strong>
                </div>
                <div class="col-4">
                  <small class="text-muted d-block">좋아요</small>
                  <strong class="text-danger"><%= post.author.activityStats.likesReceived || 0 %></strong>
                </div>
              </div>
            <% } %>
          </div>
        </div>

        <!-- 최근 게시글 -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0 pb-0">
            <h6 class="mb-0 d-flex align-items-center">
              <i class="fas fa-clock me-2 text-primary"></i>최근 게시글
            </h6>
          </div>
          <div class="card-body pt-3">
            <% if (recentPosts && recentPosts.length > 0) { %>
              <div class="recent-posts-list">
                <% recentPosts.forEach((recentPost, index) => { %>
                  <div class="recent-post-item <%= index < recentPosts.length - 1 ? 'mb-3 pb-3 border-bottom' : '' %>">
                    <div class="d-flex align-items-start gap-3">
                      <!-- 카테고리 배지 -->
                      <div class="category-badge-container">
                        <span class="category-badge 
                          <%= recentPost.category === 'notice' ? 'badge-notice' : 
                              recentPost.category === 'info' ? 'badge-info' :
                              recentPost.category === 'qna' ? 'badge-qna' : 'badge-general' %>">
                          <%= recentPost.category === 'general' ? '자유' :
                              recentPost.category === 'info' ? '정보' :
                              recentPost.category === 'notice' ? '공지' :
                              recentPost.category === 'qna' ? 'Q&A' : recentPost.category %>
                        </span>
                      </div>
                      
                      <!-- 게시글 정보 -->
                      <div class="post-info flex-grow-1">
                        <div class="post-title-container mb-2">
                          <h6 class="post-title mb-0">
                            <a href="/posts/<%= recentPost._id %>" class="text-decoration-none text-dark">
                              <%= recentPost.title.length > 30 ? recentPost.title.substring(0, 30) + '...' : recentPost.title %>
                              <% if (recentPost.isPrivate) { %>
                                <i class="fas fa-lock text-warning ms-1" title="비밀글"></i>
                              <% } %>
                            </a>
                          </h6>
                        </div>
                        
                        <div class="post-meta d-flex justify-content-between align-items-center">
                          <div class="author-info d-flex align-items-center">
                            <i class="fas fa-user-circle me-1 text-muted"></i>
                            <small class="text-muted"><%= recentPost.author.name %></small>
                          </div>
                          <div class="date-info">
                            <small class="text-muted">
                              <%= new Date(recentPost.createdAt).toLocaleDateString('ko-KR', {
                                month: 'short',
                                day: 'numeric'
                              }) %>
                            </small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% }) %>
              </div>
              
              <div class="text-center mt-4">
                <a href="/posts" class="btn btn-outline-primary btn-sm px-4">
                  <i class="fas fa-list me-2"></i>전체 게시글 보기
                </a>
              </div>
            <% } else { %>
              <div class="empty-state text-center py-4">
                <div class="empty-icon mb-3">
                  <i class="fas fa-newspaper fa-3x text-muted opacity-50"></i>
                </div>
                <p class="text-muted mb-3">최근 게시글이 없습니다</p>
                <a href="/posts" class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-plus me-2"></i>첫 게시글 작성하기
                </a>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 이미지 모달 -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-0">
        <img id="modalImage" src="" alt="" class="img-fluid w-100">
      </div>
    </div>
  </div>
</div>

<style>
  .avatar-circle {
    width: 40px;
    height: 40px;
    background: #f8f9fa;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
  }
  
  .post-content {
    font-size: 1.1rem;
    line-height: 1.7;
  }
  
  .content-text {
    margin-bottom: 1rem;
  }
  
  .comment-item:last-child {
    border-bottom: none !important;
  }
  
  .post-images img {
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  
  .post-images img:hover {
    transform: scale(1.02);
  }
  
  .youtube-container {
    margin: 1rem 0;
  }
  
  /* 최근 게시글 스타일 */
  .recent-posts-list {
    max-height: 400px;
    overflow-y: auto;
  }
  
  .recent-post-item {
    transition: all 0.2s ease;
  }
  
  .recent-post-item:hover {
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 8px;
    margin: -8px;
  }
  
  .category-badge-container {
    flex-shrink: 0;
    width: 60px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 2px;
  }
  
  .category-badge {
    font-size: 0.7rem;
    font-weight: 500;
    padding: 4px 8px;
    border-radius: 12px;
    text-align: center;
    min-width: 50px;
    display: inline-block;
    white-space: nowrap;
  }
  
  .badge-notice {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
  }
  
  .badge-info {
    background: linear-gradient(135deg, #28a745, #1e7e34);
    color: white;
  }
  
  .badge-qna {
    background: linear-gradient(135deg, #17a2b8, #138496);
    color: white;
  }
  
  .badge-general {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    color: white;
  }
  
  .post-info {
    min-width: 0;
  }
  
  .post-title {
    font-size: 0.9rem;
    line-height: 1.4;
    font-weight: 500;
  }
  
  .post-title a {
    transition: color 0.2s ease;
  }
  
  .post-title a:hover {
    color: #0d6efd !important;
  }
  
  .post-meta {
    font-size: 0.8rem;
  }
  
  .author-info {
    color: #6c757d;
  }
  
  .date-info {
    color: #6c757d;
  }
  
  .empty-state {
    padding: 2rem 1rem;
  }
  
  .empty-icon {
    opacity: 0.3;
  }

  /* 등급별 배지 스타일 */
  .level-2-silver {
    background: linear-gradient(45deg, #c0c0c0, #e8e8e8) !important;
    color: #333 !important;
    border: 1px solid #b0b0b0 !important;
  }

  .level-4-platinum {
    background: linear-gradient(45deg, #8e44ad, #9b59b6, #e74c3c) !important;
    color: white !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2) !important;
  }

  .level-5-diamond {
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57) !important;
    background-size: 300% 300% !important;
    animation: diamondShine 3s ease-in-out infinite !important;
    color: white !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
  }

  @keyframes diamondShine {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
</style>

<script>
// 좋아요 상태 초기화
let isLiked = false;
<% if (user && post.isLiked) { %>
isLiked = true;
<% } %>
updateLikeButton();

// 좋아요 토글
function toggleLike() {
  <% if (!user) { %>
    alert('로그인이 필요합니다.');
    location.href = '/login';
    return;
  <% } %>
  
  fetch(`/posts/<%= post._id %>/like`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.liked !== undefined) {
      isLiked = data.liked;
      document.getElementById('likesCount').textContent = data.likesCount;
      updateLikeButton();
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('오류가 발생했습니다.');
  });
}

function updateLikeButton() {
  const btn = document.getElementById('likeBtn');
  const icon = document.getElementById('likeIcon');
  const text = document.getElementById('likeText');
  
  if (isLiked) {
    btn.classList.remove('btn-outline-danger');
    btn.classList.add('btn-danger');
    text.textContent = '좋아요 취소';
  } else {
    btn.classList.remove('btn-danger');
    btn.classList.add('btn-outline-danger');
    text.textContent = '좋아요';
  }
}

// 댓글 작성
document.getElementById('commentForm')?.addEventListener('submit', function(e) {
  e.preventDefault();
  
  const content = document.getElementById('commentContent').value.trim();
  if (!content) {
    alert('댓글 내용을 입력해주세요.');
    return;
  }
  
  fetch(`/posts/<%= post._id %>/comments`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ content })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload(); // 댓글 목록 새로고침
    } else {
      alert('댓글 작성에 실패했습니다.');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('오류가 발생했습니다.');
  });
});

// 댓글 삭제
function deleteComment(commentId) {
  if (confirm('정말로 이 댓글을 삭제하시겠습니까?')) {
    fetch(`/posts/<%= post._id %>/comments/${commentId}`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.message) {
        location.reload();
      } else {
        alert('댓글 삭제에 실패했습니다.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('오류가 발생했습니다.');
    });
  }
}

// 게시글 삭제
function deletePost(postId) {
  if (confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
    fetch(`/posts/${postId}/delete`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => {
      if (response.ok) {
        window.location.href = '/posts';
      } else {
        alert('삭제 중 오류가 발생했습니다.');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('삭제 중 오류가 발생했습니다.');
    });
  }
}

// 이미지 모달
function openImageModal(imageSrc) {
  document.getElementById('modalImage').src = imageSrc;
  new bootstrap.Modal(document.getElementById('imageModal')).show();
}
</script>

<%- include('../partials/footer') %>

<!-- Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- AOS Animation Library -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();
</script>

</body>
</html> 